# Data Model: RAG-Enabled AI Agent

## Overview
This document defines the data models for the RAG-enabled AI agent system, including entities, relationships, and validation rules derived from the feature requirements.

## Core Entities

### AgentQuery
**Description**: Represents a query submitted to the AI agent

**Fields**:
- `query_text` (string, required): The user's question or query text
- `context_text` (string, optional): Optional selected text provided as context
- `query_id` (string, required): Unique identifier for the query
- `created_at` (datetime, required): Timestamp when the query was created
- `user_id` (string, optional): Identifier for the user making the query
- `query_type` (enum, required): Type of query ("general" | "context-specific")

**Validation Rules**:
- `query_text` must be 1-2000 characters
- `query_id` must be unique and follow UUID format
- `query_type` must be one of the allowed values

### AgentResponse
**Description**: Represents the response generated by the AI agent

**Fields**:
- `response_text` (string, required): The agent's response to the query
- `query_id` (string, required): Reference to the original query
- `retrieved_chunks` (array of objects, required): List of content chunks used
- `confidence_score` (float, required): Confidence level of the response (0-1)
- `response_id` (string, required): Unique identifier for the response
- `created_at` (datetime, required): Timestamp when the response was created
- `sources` (array of strings, optional): List of source references
- `metadata` (object, optional): Additional response metadata

**Validation Rules**:
- `response_text` must be 1-10000 characters
- `confidence_score` must be between 0 and 1
- `retrieved_chunks` must contain at least one chunk when response is generated
- `query_id` must reference an existing query

### RetrievedChunk
**Description**: Represents a content chunk retrieved from the RAG pipeline

**Fields**:
- `content` (string, required): The actual content text
- `similarity_score` (float, required): Similarity score from retrieval (0-1)
- `chunk_id` (string, required): Unique identifier for the chunk
- `metadata` (object, required): Additional metadata about the source
- `position` (integer, required): Position in the original document

**Validation Rules**:
- `similarity_score` must be between 0 and 1
- `content` must not be empty
- `chunk_id` must be unique within the system

### AgentConfiguration
**Description**: Configuration settings for the AI agent

**Fields**:
- `agent_id` (string, required): Unique identifier for the agent
- `model_name` (string, required): Name of the OpenAI model to use
- `temperature` (float, required): Temperature setting for response creativity
- `max_tokens` (integer, required): Maximum tokens in response
- `retrieval_threshold` (float, required): Minimum similarity score for retrieval
- `context_window` (integer, required): Maximum context window size

**Validation Rules**:
- `temperature` must be between 0 and 1
- `max_tokens` must be between 1 and 4096
- `retrieval_threshold` must be between 0 and 1

## Relationships

```
AgentQuery (1) → (1) AgentResponse
AgentResponse (1) → (many) RetrievedChunk
```

## State Transitions

### Query Processing States
1. **PENDING**: Query received, waiting for processing
2. **RETRIEVING**: Retrieval pipeline is being executed
3. **GENERATING**: Agent is generating response
4. **COMPLETED**: Response generated successfully
5. **FAILED**: Processing failed due to error

## Data Flow

```
AgentQuery → [Validation] → [Retrieval] → [Agent Processing] → AgentResponse
```

## Validation Rules Summary

- All text fields must be properly sanitized
- Query and response IDs must follow UUID format
- Confidence scores and similarity scores must be between 0 and 1
- All required fields must be present
- Retrieved chunks must have valid metadata